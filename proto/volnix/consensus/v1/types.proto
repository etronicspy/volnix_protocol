syntax = "proto3";
package volnix.consensus.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/volnix-protocol/volnix-protocol/proto/gen/go/volnix/consensus/v1;consensusv1";

// Validator represents a validator in the PoVB consensus system
message Validator {
  string validator = 1;
  string ant_balance = 2;
  ValidatorStatus status = 3;
  google.protobuf.Timestamp last_active = 4;
  uint64 last_block_height = 5;
  string moa_score = 6;
  string activity_score = 7;
  uint64 total_blocks_created = 8;
  string total_burn_amount = 9;
}

// ValidatorStatus represents the status of a validator
enum ValidatorStatus {
  VALIDATOR_STATUS_UNSPECIFIED = 0;
  VALIDATOR_STATUS_ACTIVE = 1;
  VALIDATOR_STATUS_INACTIVE = 2;
  VALIDATOR_STATUS_SLASHED = 3;
}

// BlockCreator represents a validator selected to create the next block
message BlockCreator {
  string validator = 1;
  string ant_balance = 2;
  string activity_score = 3;
  string burn_amount = 4;
  uint64 block_height = 5;
  google.protobuf.Timestamp selection_time = 6;
}

// BurnProof represents proof of token burning for consensus
message BurnProof {
  string validator = 1;
  string burn_amount = 2;
  string burn_hash = 3;
  uint64 block_height = 4;
  google.protobuf.Timestamp burn_time = 5;
  string proof_signature = 6;
}

// ActivityScore represents the activity score of a validator
message ActivityScore {
  string validator = 1;
  uint64 score = 2;
  uint64 ant_balance = 3;
  uint64 blocks_created = 4;
  uint64 transactions_processed = 5;
  google.protobuf.Timestamp last_update = 6;
}

// Params defines the parameters for the consensus module
message Params {
  string base_block_time = 1;
  uint64 high_activity_threshold = 2;
  uint64 low_activity_threshold = 3;
  string min_burn_amount = 4;
  string max_burn_amount = 5;
  uint64 block_creator_selection_rounds = 6;
  string activity_decay_rate = 7;
  string moa_penalty_rate = 8;
}

// GenesisState moved to genesis.proto to avoid duplication

// HalvingInfo represents halving information
// According to whitepaper: "Халвинг происходит строго каждые N блоков, но реальная дата адаптируется к динамическому времени блока"
message HalvingInfo {
  uint64 last_halving_height = 1;
  uint64 halving_interval = 2;
  uint64 next_halving_height = 3;
  google.protobuf.Timestamp estimated_next_halving_date = 4; // Estimated date based on average block time
  google.protobuf.Timestamp last_halving_date = 5; // Actual date of last halving
}

// ConsensusState represents the current consensus state
message ConsensusState {
  uint64 current_height = 1;
  string total_ant_burned = 2;
  google.protobuf.Timestamp last_block_time = 3;
  repeated string active_validators = 4;
}

// ValidatorWeight represents validator weight information
message ValidatorWeight {
  string validator = 1;
  string weight = 2;
}

// EncryptedBid represents a committed bid in the blind auction
// This is the commit phase: validator submits encrypted/hashed bid
message EncryptedBid {
  string validator = 1;
  string commit_hash = 2; // Hash of (nonce + bid_amount)
  uint64 block_height = 3;
  google.protobuf.Timestamp commit_time = 4;
}

// BidReveal represents a revealed bid in the blind auction
// This is the reveal phase: validator reveals nonce and bid amount
message BidReveal {
  string validator = 1;
  string nonce = 2; // Random nonce used in commit
  string bid_amount = 3; // ANT amount bid
  uint64 block_height = 4;
  google.protobuf.Timestamp reveal_time = 5;
}

// AuctionPhase represents the current phase of the blind auction
enum AuctionPhase {
  AUCTION_PHASE_UNSPECIFIED = 0;
  AUCTION_PHASE_COMMIT = 1; // Validators can submit encrypted bids
  AUCTION_PHASE_REVEAL = 2; // Validators reveal their bids
  AUCTION_PHASE_COMPLETE = 3; // Auction is complete, winner selected
}

// BlindAuction represents a blind auction for block creation rights
message BlindAuction {
  uint64 block_height = 1;
  AuctionPhase phase = 2;
  repeated EncryptedBid commits = 3; // Committed bids
  repeated BidReveal reveals = 4; // Revealed bids
  string winner = 5; // Winner validator address
  string winning_bid = 6; // Winning bid amount
  google.protobuf.Timestamp start_time = 7;
  google.protobuf.Timestamp end_time = 8;
}
