# Волникс Протокол - Cursor Rules

## Проект
Волникс Протокол (Volnix Protocol) - суверенный блокчейн первого уровня на базе Cosmos SDK с гибридным консенсусом Proof-of-Verified-Burn (PoVB) и трехуровневой экономической моделью.

## Технологический стек
- **Фреймворк:** Cosmos SDK v0.53.x
- **Язык:** Go (Golang) 
- **Консенсус:** CometBFT (v0.38.x)
- **Криптография:** ECDSA (secp256k1), zk-SNARK
- **Архитектура:** Модульная (стандартные + 4 кастомных модуля)

## Архитектура модулей

### Кастомные модули Cosmos SDK:
1. **`x/ident`** - Управление ZKP-ролями, миграцией, правилами активности
2. **`x/lizenz`** - Управление токеном LZN, активацией, MOA
3. **`x/anteil`** - Внутренний рынок ANT, аукционы, книга ордеров
4. **`x/consensus`** - Консенсус PoVB, выбор создателя блока

### Активы:
- **WRT (Wert)** - Основной токен, ценность и голос
- **LZN (Lizenz)** - Лицензия на майнинг, торгуемый
- **ANT (Anteil)** - Право на производительность, неторгуемый

### Роли:
- **Гость** - Неверифицированный, базовый функционал
- **Гражданин** - Верифицированный, получает ANT, продавец на рынке
- **Валидатор** - Верифицированный, активирует LZN, покупатель ANT

## Стиль кода и конвенции

### Go (Golang):
- Следуйте стандартным Go conventions
- Используйте camelCase для переменных и функций
- PascalCase для экспортируемых имен
- Комментарии на английском языке
- Документируйте все публичные функции

### Cosmos SDK специфики:
- gRPC-first: определяйте protobuf `Msg`/`Query` и реализуйте `MsgServer`/`QueryServer` (без legacy `sdk.Handler`/`Route`)
- Генезис только через protobuf (`genesis.proto`) с обязательной валидацией
- Хранилище: используйте `cosmossdk.io/store/prefix` и protobuf-сериализацию через `cdc` (не JSON в KV)
- Числа: `cosmossdk.io/math` (`Int`), для десятичных параметров — `sdk.Dec`
- Модули должны реализовывать стандартные интерфейсы Cosmos SDK и регистрировать сервисы в `RegisterServices(cfg)`
- Реализуйте `BeginBlocker` и `EndBlocker` где необходимо
- Следуйте паттернам state management Cosmos SDK

### Криптография и безопасность:
- Все ZKP операции должны быть верифицированы
- Проверяйте подписи для всех транзакций
- Используйте безопасные генераторы случайных чисел
- Валидируйте все входные данные

## Специфические требования

### ZKP интеграция:
- Верификация уникальности личности через аккредитованных провайдеров
- Поддержка миграции ролей ("цифровое наследство")
- Правила активности (1 год для Граждан, 6 месяцев для Валидаторов)

### Экономическая модель:
- Двухконтурная система (безопасность + производительность)
- MOA (Минимальное Обязательство Активности) для Валидаторов
- Внутренний рынок ANT с лимитными и рыночными ордерами
- Слепой аукцион для выбора создателя блока

### Консенсус:
- Динамическое время блока на основе активности ANT
- Адаптивный халвинг (каждые N блоков)
- Взвешенная лотерея для выбора валидатора

## Структура проекта

```
volnix-protocol/
├── app/                    # Основное приложение
├── cmd/                    # CLI команды
├── x/                      # Модули
│   ├── ident/             # Модуль идентичности
│   ├── lizenz/            # Модуль лицензий  
│   ├── anteil/            # Модуль внутреннего рынка
│   └── consensus/         # Модуль консенсуса
├── proto/                  # Protobuf определения
├── client/                 # Клиентское ПО
├── docs/                   # Документация
└── tests/                  # Тесты
```

## Тестирование

### Требования к тестам:
- Unit тесты для всех публичных функций
- Integration тесты для модулей
- End-to-end тесты для экономических сценариев
- Тесты безопасности для ZKP и аукционов
- Бенчмарки для критических операций

### Тестовые сценарии:
- Верификация и миграция ролей
- Активация/деактивация LZN
- Торговля на внутреннем рынке ANT
- Аукционы и лотереи
- MOA проверки и наказания

## Документация

### Обязательная документация:
- README с описанием архитектуры
- API документация для всех модулей
- Руководство по развертыванию
- Экономическая модель и токеномика
- Безопасность и аудит

### Комментарии в коде:
- Документируйте сложную бизнес-логику
- Объясняйте криптографические операции
- Описывайте экономические механизмы
- Комментируйте интеграции между модулями

## Безопасность

### Критические области:
- ZKP верификация и миграция
- Аукционы и лотереи
- Управление состоянием ролей
- Экономические расчеты
- Интеграция с консенсусом

### Аудит:
- Все кастомные модули должны пройти аудит
- Особое внимание к экономической логике
- Проверка на уязвимости в ZKP интеграции
- Тестирование на атаки Сивиллы

## Производительность

### Оптимизации:
- Эффективные алгоритмы matching engine
- Кэширование часто используемых данных
- Оптимизация запросов к state
- Минимизация накладных расходов консенсуса

## Совместимость

### Cosmos SDK:
- Следуйте семантическому версионированию (v0.53.x)
- Не использовать legacy `sdk.Handler`/`Route`; только `MsgServer`/`QueryServer`
- Тестируйте с новыми версиями SDK
- Документируйте breaking changes

## Развертывание

### Требования:
- Поддержка Docker контейнеризации
- Конфигурация через environment variables
- Логирование и мониторинг
- Backup и recovery процедуры

## Глоссарий

- **ZKP** - Zero-Knowledge Proof, доказательства с нулевым разглашением
- **MOA** - Минимальное Обязательство Активности
- **ANT** - Anteil, право на производительность
- **LZN** - Lizenz, лицензия на майнинг
- **WRT** - Wert, основной токен сети
- **PoVB** - Proof-of-Verified-Burn, гибридный консенсус
- **DAO** - Децентрализованная автономная организация 