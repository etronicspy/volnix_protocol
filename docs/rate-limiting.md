# üõ°Ô∏è Rate Limiting

## –û–±–∑–æ—Ä

Volnix Protocol –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS –∞—Ç–∞–∫ –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π. Rate limiting –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Rate Limiter

`RateLimiter` —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–≤—É–º—è —É—Ä–æ–≤–Ω—è–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:

1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç** - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –≤—Å–µ–π —Å–µ—Ç–∏
2. **–õ–∏–º–∏—Ç –Ω–∞ –∞–¥—Ä–µ—Å** - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–¥—Ä–µ—Å–∞

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```go
type RateLimitConfig struct {
    GlobalRate  float64 // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –≥–ª–æ–±–∞–ª—å–Ω–æ
    PerAddrRate float64 // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –Ω–∞ –∞–¥—Ä–µ—Å
    BurstSize   int     // –†–∞–∑–º–µ—Ä burst (–≤–Ω–µ–∑–∞–ø–Ω—ã–π –≤—Å–ø–ª–µ—Å–∫)
    Enabled     bool    // –í–∫–ª—é—á–µ–Ω –ª–∏ rate limiting
}
```

### –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- **GlobalRate**: 1000 tx/sec (1000 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –≥–ª–æ–±–∞–ª—å–Ω–æ)
- **PerAddrRate**: 10 tx/sec (10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –Ω–∞ –∞–¥—Ä–µ—Å)
- **BurstSize**: 20 (—Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–ø–ª–µ—Å–∫ –¥–æ 20 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- **Enabled**: true (–≤–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ

Rate limiting –≤–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:

```go
config := RateLimitConfig{
    Enabled: false,
}
rateLimiter := NewRateLimiter(config)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤

```go
config := RateLimitConfig{
    GlobalRate:  2000.0, // –£–≤–µ–ª–∏—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç
    PerAddrRate: 20.0,   // –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –∞–¥—Ä–µ—Å
    BurstSize:   30,     // –£–≤–µ–ª–∏—á–∏—Ç—å burst size
    Enabled:     true,
}
rateLimiter := NewRateLimiter(config)
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ AnteHandler

Rate limiting –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ AnteHandler:

```go
func (app *VolnixApp) createAnteHandler() sdk.AnteHandler {
    return func(ctx sdk.Context, tx sdk.Tx, simulate bool) (sdk.Context, error) {
        // Rate limiting –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
        if !simulate && ctx.IsCheckTx() && app.rateLimiter != nil {
            if err := app.rateLimiter.Allow(ctx, tx); err != nil {
                return ctx, fmt.Errorf("rate limit check failed: %w", err)
            }
        }
        
        // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –æ–±—ã—á–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
        return ImprovedAnteHandler(ctx, tx, simulate)
    }
}
```

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ

### –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è rate limiting

- ‚úÖ **CheckTx** - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ mempool
- ‚ùå **DeliverTx** - –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–∂–µ –≤ –±–ª–æ–∫–µ)
- ‚ùå **Simulate** - –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (—Å–∏–º—É–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- ‚ùå **RecheckTx** - –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

### –û—à–∏–±–∫–∏ rate limiting

–ö–æ–≥–¥–∞ rate limit –ø—Ä–µ–≤—ã—à–µ–Ω, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π:

```
rate limit exceeded for address <address>: 10 tx/sec
```

–∏–ª–∏

```
global rate limit exceeded: 1000 tx/sec
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ rate limiter

```go
stats := rateLimiter.GetStats()
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
// {
//   "enabled": true,
//   "global_rate": 1000.0,
//   "per_addr_rate": 10.0,
//   "burst_size": 20,
//   "address_count": 150,
//   "global_available": 950.0
// }
```

### –ú–µ—Ç—Ä–∏–∫–∏

Rate limiting –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑-–∑–∞ rate limiting
- –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ —Å rate limiting

## Best Practices

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è production

1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏
   - –î–ª—è –º–∞–ª—ã—Ö —Å–µ—Ç–µ–π: 500-1000 tx/sec
   - –î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —Å–µ—Ç–µ–π: 1000-5000 tx/sec
   - –î–ª—è –±–æ–ª—å—à–∏—Ö —Å–µ—Ç–µ–π: 5000+ tx/sec

2. **–õ–∏–º–∏—Ç –Ω–∞ –∞–¥—Ä–µ—Å**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 5-10 tx/sec
   - –î–ª—è –±–æ—Ç–æ–≤/—Å–∫—Ä–∏–ø—Ç–æ–≤: 1-5 tx/sec
   - –î–ª—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤: 20-50 tx/sec

3. **Burst size**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 10-20
   - –î–ª—è –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤: 30-50

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å rate limiting:

```go
config := RateLimitConfig{
    Enabled: false,
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –¥–ª—è:
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ (–º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ DDoS)
- –ë–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ù–µ–æ–±—ã—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## Troubleshooting

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –∏–∑-–∑–∞ rate limiting

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã:
   ```go
   stats := rateLimiter.GetStats()
   ```

2. –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
   ```go
   config := RateLimitConfig{
       GlobalRate:  2000.0, // –£–≤–µ–ª–∏—á–∏—Ç—å
       PerAddrRate: 20.0,   // –£–≤–µ–ª–∏—á–∏—Ç—å
       Enabled:     true,
   }
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ DDoS –∞—Ç–∞–∫–æ–π

### Rate limiting –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ rate limiting –≤–∫–ª—é—á–µ–Ω:
   ```go
   if rateLimiter == nil {
       // Rate limiting –æ—Ç–∫–ª—é—á–µ–Ω
   }
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ CheckTx (–Ω–µ DeliverTx)

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Token Bucket Algorithm](https://en.wikipedia.org/wiki/Token_bucket)
- [DDoS Protection Best Practices](https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack/)

